!function(){"use strict";class s{constructor(s){this.htmlElement=s,this.resize()}resize(){}paint(s){console.log(JSON.stringify(s,null,2))}}class i extends s{constructor(s){super(s),this.isMobile=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)}resize(){}paint(s){if(this.isMobile)return;let i="";function e(s){return s.toPrecision(2).padStart(10)}s.forEach(s=>{i+=`<br>${s.name.padStart(12)} {  x:${e(s.x)}  y:${e(s.y)}  z:${e(s.z)}  mass:${e(s.mass)}) }`}),this.htmlElement&&(this.htmlElement.innerHTML=i)}}class e extends s{constructor(s){super(s),window.onresize=this.resize.bind(this)}resize(){this.htmlElement&&(this.sizeX=this.htmlElement.offsetWidth,this.sizeY=this.htmlElement.offsetHeight,this.htmlElement.width=this.sizeX,this.htmlElement.height=this.sizeY,this.vis=this.htmlElement.getContext("2d"))}paint(s){if(!this.htmlElement)return;const i=this.bounds(s),e=i.xMin,t=i.yMin,r=2*Math.PI;let o=this.sizeX/(i.xMax-i.xMin),a=this.sizeY/(i.yMax-i.yMin);(isNaN(o)||!isFinite(o)||o<15)&&(o=15),(isNaN(a)||!isFinite(a)||a<15)&&(a=15),this.vis.clearRect(0,0,this.vis.canvas.width,this.vis.canvas.height),s.forEach((s,i)=>{const n=(s.x-e)*o,h=(s.y-t)*a;this.vis.beginPath(),this.vis.arc(n,h,s.drawSize,0,r,!1),this.vis.fillStyle=s.color||"#aaa",this.vis.fill()})}bounds(s){const i={xMin:0,xMax:0,yMin:0,yMax:0,zMin:0,zMax:0};return s.forEach(s=>{i.xMin>s.x&&(i.xMin=s.x),i.xMax<s.x&&(i.xMax=s.x),i.yMin>s.y&&(i.yMin=s.y),i.yMax<s.y&&(i.yMax=s.y),i.zMin>s.z&&(i.zMin=s.z),i.zMax<s.z&&(i.zMax=s.z)}),i}}class t{constructor(s,i,e,t,r,o,a,n,h){this.name=s,this.color=i,this.x=e,this.y=t,this.z=r,this.mass=o,this.vX=a||0,this.vY=n||0,this.vZ=h||0,this.forceX=0,this.forceY=0,this.forceZ=0,this.drawSize=Math.min(Math.max(Math.log10(o),1),10)}}class r{constructor(){this.setupWebWorker(),this.simulationSpeed=33,this.objBodies=[],this.bodySize=4,this.forceSize=3,this.debrisBounds=12,this.workerReady=!1,this.workerCalculating=!1,this.visualizations=[]}ready(){return this.workerReady&&!this.workerCalculating}addBody(s){this.objBodies.push(s)}start(){const s=this.step.bind(this);setInterval(s,this.simulationSpeed)}async step(){this.ready()?await this.calculateForces():console.log(`Skipping calcuation:  WorkerReady: ${this.workerReady}   WorkerCalculating: ${this.workerCalculating}`),this.trimDebris(),this.applyForces(),this.visualize()}calculateForces(){this.workerCalculating=!0,this.arrBodies=[],this.objBodies.forEach((s,i)=>{const e=i*this.bodySize;this.arrBodies[e]=s.x,this.arrBodies[e+1]=s.y,this.arrBodies[e+2]=s.z,this.arrBodies[e+3]=s.mass});const s=new Promise((s,i)=>{this.forcesResolve=s,this.forcesReject=i});return this.worker.postMessage({purpose:"nBodyForces",arrBodies:this.arrBodies}),s}trimDebris(){this.objBodies=this.objBodies.filter(s=>"debris"!==s.name||!(isNaN(s.x)||isNaN(s.y)||isNaN(s.z))&&(!(s.x<-this.debrisBounds||s.x>this.debrisBounds)&&(!(s.y<-this.debrisBounds||s.y>this.debrisBounds)&&!(s.z<-this.debrisBounds||s.z>this.debrisBounds))))}applyForces(){this.objBodies.forEach((s,i)=>{0!==s.mass&&this.arrForces&&(s.forceX=this.arrForces[i*this.forceSize+0],s.forceY=this.arrForces[i*this.forceSize+1],s.forceZ=this.arrForces[i*this.forceSize+2],s.vX=s.vX+s.forceX/s.mass,s.vY=s.vY+s.forceY/s.mass,s.vZ=s.vZ+s.forceZ/s.mass,s.x=s.x+s.vX,s.y=s.y+s.vY,s.z=s.z+s.vZ)})}visualize(){this.visualizations.forEach(s=>{s.paint(this.objBodies)})}addVisualization(s){this.visualizations.push(s)}setupWebWorker(){this.worker=new Worker("workerWasm.js"),this.worker.onerror=function(s){console.log(`Error from Web Worker: ${s.message}`)};const s=this;this.worker.onmessage=function(i){if(i&&i.data){const e=i.data;switch(e.purpose){case"wasmReady":s.workerReady=!0;break;case"nBodyForces":s.workerCalculating=!1,e.error?s.forcesReject(e.error):(s.arrForces=e.arrForces,s.forcesResolve(s.arrForces))}}},WebAssembly.compileStreaming(fetch("assembly/nBodyForces.wasm")).then(i=>{s.worker.postMessage({purpose:"wasmModule",wasmModule:i})})}}window.onload=function(){const s=new r;function o(s){return(Math.random()-.5)*s}s.addVisualization(new i(document.getElementById("visPrettyPrint"))),s.addVisualization(new e(document.getElementById("visCanvas"))),s.addBody(new t("star","yellow",0,0,0,1e9)),s.addBody(new t("hot jupiter","red",-1,-1,0,1e4,.24,-.05,0)),s.addBody(new t("cold jupiter","purple",4,4,-.1,1e4,-.07,.04,0)),s.addBody(new t("asteroid","black",-15,-15,0,0)),s.addBody(new t("asteroid","black",15,15,0,0)),s.start(),s.addBody(new t("saturn","blue",-8,-8,.1,1e3,.07,-.035,0)),document.getElementById("mayhem").addEventListener("click",()=>{for(let i=0;i<10;i++)s.addBody(new t("debris","white",o(10),o(10),o(10),1,o(.1),o(.1),o(.1)))})}}();
//# sourceMappingURL=main.js.map
